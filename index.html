<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Jojo Poker</title>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, doc, setDoc, updateDoc, getDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBiurHUaSI9ytpiTLps9MqY4QHF4MbEt24",
  authDomain: "jojo-pokler.firebaseapp.com",
  projectId: "jojo-pokler",
  storageBucket: "jojo-pokler.firebasestorage.app",
  messagingSenderId: "963260398028",
  appId: "1:963260398028:web:ce28df14ea78042e968569"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// HTML Elements
const nameInput = document.getElementById("nameInput");
const joinBtn = document.getElementById("joinBtn");
const playersList = document.getElementById("players");

let playerName = "";

// -------------------- Join Lobby --------------------
joinBtn.addEventListener("click", async () => {
  const name = nameInput.value.trim();
  if (!name) return alert("Enter your name!");
  playerName = name;

  try {
    // Use a fixed session ID "current" so we always have one session in Firestore
    const sessionDoc = doc(db, "sessions", "current");
    const sessionSnap = await getDoc(sessionDoc);

    let players = [];
    if (sessionSnap.exists()) {
      const sessionData = sessionSnap.data();
      players = sessionData.players || [];
    }

    // Add player if not already in list
    if (!players.includes(name)) players.push(name);

    // Create or update session document
    await setDoc(sessionDoc, { players, holeCards: {}, board: { flop: ["", "", ""], turn: "", river: "" } });

    alert(`✅ Joined lobby as ${name}`);
  } catch (err) {
    console.error("Error joining lobby:", err);
    alert("❌ Could not join lobby. Check console for details.");
  }
});

// -------------------- Live update of players --------------------
const sessionDoc = doc(db, "sessions", "current");

onSnapshot(sessionDoc, docSnap => {
  if (!docSnap.exists()) return;
  const data = docSnap.data();

  // Update players list
  playersList.innerHTML = "";
  (data.players || []).forEach(name => {
    const li = document.createElement("li");
    li.textContent = name;
    playersList.appendChild(li);
  });
});
</script>
</head>
<body>
<h1>Jojo Poker Lobby</h1>
<input id="nameInput" placeholder="Enter your name" />
<button id="joinBtn">Join Lobby</button>

<h2>Players in Lobby:</h2>
<ul id="players"></ul>
</body>
</html>
