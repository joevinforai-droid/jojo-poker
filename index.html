<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Jojo Poker</title>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore-compat.js"></script>
</head>
<body>
<h1>Jojo Poker Lobby</h1>

<input id="nameInput" placeholder="Enter your name" />
<button id="joinBtn">Join Lobby</button>

<h2>Players in Lobby:</h2>
<ul id="players"></ul>

<div id="holeCardsDiv" style="display:none;">
  <h2>Your Hole Cards</h2>
  <input id="card1" placeholder="Card 1 (e.g., Ah)" />
  <input id="card2" placeholder="Card 2 (e.g., Kd)" />
  <button id="submitHoleBtn">Submit Hole Cards</button>
</div>

<div id="adminDiv" style="display:none;">
  <h2>Admin / Dealer View</h2>
  <ul id="allHoleCardsList"></ul>

  <h3>Board Cards</h3>
  <input id="flop1Input" placeholder="Flop Card 1" />
  <input id="flop2Input" placeholder="Flop Card 2" />
  <input id="flop3Input" placeholder="Flop Card 3" />
  <input id="turnInput" placeholder="Turn Card" />
  <input id="riverInput" placeholder="River Card" />
  <button id="submitBoardBtn">Update Board</button>
  <button id="resetBoardBtn">Reset Board</button>
</div>

<script>
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const nameInput = document.getElementById("nameInput");
const joinBtn = document.getElementById("joinBtn");
const playersList = document.getElementById("players");
const holeCardsDiv = document.getElementById("holeCardsDiv");
const card1Input = document.getElementById("card1");
const card2Input = document.getElementById("card2");
const submitHoleBtn = document.getElementById("submitHoleBtn");
const adminDiv = document.getElementById("adminDiv");
const allHoleCardsList = document.getElementById("allHoleCardsList");
const flopInputs = [
  document.getElementById("flop1Input"),
  document.getElementById("flop2Input"),
  document.getElementById("flop3Input")
];
const turnInput = document.getElementById("turnInput");
const riverInput = document.getElementById("riverInput");
const submitBoardBtn = document.getElementById("submitBoardBtn");
const resetBoardBtn = document.getElementById("resetBoardBtn");

let playerName = "";
const sessionDoc = db.collection("sessions").doc("current");

// Join lobby
joinBtn.onclick = async function() {
  const name = nameInput.value.trim();
  if(!name) return alert("Enter your name!");
  playerName = name;
  const docSnap = await sessionDoc.get();
  const data = docSnap.exists ? docSnap.data() : {};
  const players = data.players || [];
  if(!players.includes(name)) players.push(name);

  await sessionDoc.set({
    players: players,
    holeCards: data.holeCards || {},
    board: data.board || { flop:["","",""], turn:"", river:"" },
    status: "waiting"
  });

  holeCardsDiv.style.display = "block";
  adminDiv.style.display = "block";
}

// Live updates
sessionDoc.onSnapshot(docSnap=>{
  if(!docSnap.exists) return;
  const data = docSnap.data();

  // Players
  playersList.innerHTML = "";
  (data.players||[]).forEach(n=>{
    const li = document.createElement("li");
    li.textContent = n;
    playersList.appendChild(li);
  });

  // Hole cards
  allHoleCardsList.innerHTML = "";
  for(const [name,cards] of Object.entries(data.holeCards||{})){
    const li = document.createElement("li");
    li.textContent = name+": "+cards.join(", ");
    allHoleCardsList.appendChild(li);
  }

  // Board
  data.board.flop.forEach((card,i)=>{
    if(flopInputs[i].value!==card && document.activeElement!==flopInputs[i]) flopInputs[i].value = card;
  });
  if(turnInput.value!==data.board.turn && document.activeElement!==turnInput) turnInput.value = data.board.turn||"";
  if(riverInput.value!==data.board.river && document.activeElement!==riverInput) riverInput.value = data.board.river||"";
});

// Submit hole cards
submitHoleBtn.onclick = async function(){
  const c1 = card1Input.value.trim();
  const c2 = card2Input.value.trim();
  if(!c1||!c2) return alert("Enter both cards!");
  const docSnap = await sessionDoc.get();
  const data = docSnap.data();
  const holeCards = Object.assign({}, data.holeCards);
  holeCards[playerName] = [c1,c2];
  await sessionDoc.update({ holeCards });
}

// Board update
submitBoardBtn.onclick = async function(){
  const docSnap = await sessionDoc.get();
  const data = docSnap.data();
  const flopValues = flopInputs.map(i=>i.value.trim());
  await sessionDoc.update({
    board: { flop: flopValues, turn: turnInput.value.trim(), river: riverInput.value.trim() }
  });
}

resetBoardBtn.onclick = async function(){
  await sessionDoc.update({ board:{ flop:["","",""], turn:"", river:"" } });
}
</script>
</body>
</html>
