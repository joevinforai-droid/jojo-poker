<!DOCTYPE html>
<html>
  <head>
    <title>Jojo Poker</title>
  </head>
  <body>
    <h1>Jojo Poker üÉè</h1>

    <div id="loginDiv">
      <input type="text" id="playerName" placeholder="Enter your name" />
      <button onclick="login()">Start</button>
    </div>

    <div id="appDiv" style="display:none;">
      <h2>Welcome, <span id="displayName"></span>!</h2>
      <button onclick="addSession()">‚ûï Add Poker Session</button>
      <ul id="sessionList"></ul>
    </div>

    <script type="module">
      // --- Firebase Setup ---
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
      import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyBiurHUaSI9ytpiTLps9MqY4QHF4MbEt24",
        authDomain: "jojo-pokler.firebaseapp.com",
        projectId: "jojo-pokler",
        storageBucket: "jojo-pokler.firebasestorage.app",
        messagingSenderId: "963260398028",
        appId: "1:963260398028:web:ce28df14ea78042e968569",
        measurementId: "G-V78WWQ0VZQ"
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      // --- Login Function ---
      function login() {
        const name = document.getElementById("playerName").value;
        if (!name) {
          alert("Please enter your name");
          return;
        }
        localStorage.setItem("playerName", name); // store locally
        document.getElementById("loginDiv").style.display = "none";
        document.getElementById("appDiv").style.display = "block";
        document.getElementById("displayName").innerText = name;
        loadSessions();
      }

      // --- Add Session Function ---
      async function addSession() {
        const name = localStorage.getItem("playerName");
        try {
          const docRef = await addDoc(collection(db, "sessions"), {
            player: name,
            buyIn: 100, // placeholder
            cashOut: 150, // placeholder
            created: new Date().toISOString()
          });
          console.log("‚úÖ Session added with ID: ", docRef.id);
          loadSessions();
        } catch (e) {
          console.error("‚ùå Error adding session: ", e);
        }
      }

      // --- Load Sessions Function ---
      async function loadSessions() {
        const sessionList = document.getElementById("sessionList");
        sessionList.innerHTML = "";
        const querySnapshot = await getDocs(collection(db, "sessions"));
        querySnapshot.forEach((doc) => {
          const data = doc.data();
          const li = document.createElement("li");
          li.textContent = `${data.player} | Buy-in: ${data.buyIn}, Cash-out: ${data.cashOut}`;
          sessionList.appendChild(li);
        });
      }

      // Auto login if name is saved
      if (localStorage.getItem("playerName")) {
        document.getElementById("loginDiv").style.display = "none";
        document.getElementById("appDiv").style.display = "block";
        document.getElementById("displayName").innerText = localStorage.getItem("playerName");
        loadSessions();
      }

      window.login = login;
      window.addSession = addSession;
    </script>
  </body>
</html>
