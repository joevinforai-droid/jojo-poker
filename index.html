<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jojo Poker - Dealer</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; background: #f4f4f4; }
h1 { text-align: center; }
.container { max-width: 800px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
input, button { padding: 8px; margin: 4px; }
.player-row { display: flex; gap: 10px; align-items: center; margin-bottom: 6px; }
.board-inputs input { width: 50px; text-align: center; }
</style>
</head>
<body>

<div class="container">
<h1>Jojo Poker - Dealer</h1>

<div>
    <button id="createSessionBtn">Create New Session</button>
    <span id="sessionIdDisplay"></span>
</div>

<h3>Add Player</h3>
<input type="text" id="playerNameInput" placeholder="Player Name">
<button id="addPlayerBtn">Add Player</button>

<h3>Players</h3>
<div id="playersList"></div>

<h3>Hole Cards</h3>
<div id="holeCardsList"></div>

<h3>Board Cards</h3>
<div class="board-inputs">
    Flop: <input id="flop1" maxlength="2"> <input id="flop2" maxlength="2"> <input id="flop3" maxlength="2"><br>
    Turn: <input id="turn" maxlength="2"><br>
    River: <input id="river" maxlength="2"><br>
    <button id="updateBoardBtn">Update Board</button>
</div>

<div id="log" style="margin-top:20px;"></div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore-compat.js"></script>

<script>
// TODO: Replace with your Firebase project config
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// State
let currentSessionId = null;
let sessionData = { players: [], holeCards: {}, board: { flop: ["","",""], turn:"", river:"" }, status:"waiting" };

// DOM Elements
const sessionIdDisplay = document.getElementById("sessionIdDisplay");
const playersList = document.getElementById("playersList");
const holeCardsList = document.getElementById("holeCardsList");
const logDiv = document.getElementById("log");

// Create session
document.getElementById("createSessionBtn").addEventListener("click", async () => {
    try {
        const docRef = await db.collection("sessions").add({
            players: [],
            holeCards: {},
            board: { flop: ["","",""], turn:"", river:"" },
            status: "waiting",
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        currentSessionId = docRef.id;
        sessionData = { players: [], holeCards: {}, board: { flop: ["","",""], turn:"", river:"" }, status:"waiting" };
        sessionIdDisplay.textContent = "Session ID: " + currentSessionId;
        playersList.innerHTML = "";
        holeCardsList.innerHTML = "";
        log("✅ Session created: " + currentSessionId);
    } catch(e) {
        log("❌ Error creating session: " + e);
    }
});

// Add player
document.getElementById("addPlayerBtn").addEventListener("click", async () => {
    const nameInput = document.getElementById("playerNameInput");
    const name = nameInput.value.trim();
    if(!name || !currentSessionId) return;
    if(sessionData.players.includes(name)) { log("❌ Player already exists"); return; }
    sessionData.players.push(name);
    sessionData.holeCards[name] = ["",""];
    await db.collection("sessions").doc(currentSessionId).update(sessionData);
    renderPlayers();
    renderHoleCards();
    nameInput.value = "";
    log("✅ Player added: " + name);
});

// Render players
function renderPlayers() {
    playersList.innerHTML = "";
    sessionData.players.forEach(player => {
        const div = document.createElement("div");
        div.textContent = player;
        playersList.appendChild(div);
    });
}

// Render hole cards
function renderHoleCards() {
    holeCardsList.innerHTML = "";
    sessionData.players.forEach(player => {
        const div = document.createElement("div");
        div.className = "player-row";
        div.innerHTML = `
            <span>${player}</span>
            Card1: <input maxlength="2" data-player="${player}" data-card="0" value="${sessionData.holeCards[player][0]}">
            Card2: <input maxlength="2" data-player="${player}" data-card="1" value="${sessionData.holeCards[player][1]}">
        `;
        holeCardsList.appendChild(div);
    });

    // Add input listeners
    holeCardsList.querySelectorAll("input").forEach(input => {
        input.addEventListener("input", async (e)=>{
            const p = e.target.dataset.player;
            const c = parseInt(e.target.dataset.card);
            sessionData.holeCards[p][c] = e.target.value.toUpperCase();
            if(currentSessionId){
                await db.collection("sessions").doc(currentSessionId).update({ holeCards: sessionData.holeCards });
            }
        });
    });
}

// Update board
document.getElementById("updateBoardBtn").addEventListener("click", async ()=>{
    const flop = [
        document.getElementById("flop1").value.toUpperCase(),
        document.getElementById("flop2").value.toUpperCase(),
        document.getElementById("flop3").value.toUpperCase()
    ];
    const turn = document.getElementById("turn").value.toUpperCase();
    const river = document.getElementById("river").value.toUpperCase();
    sessionData.board = { flop, turn, river };
    if(currentSessionId){
        try {
            await db.collection("sessions").doc(currentSessionId).update({ board: sessionData.board });
            log("✅ Board updated");
        } catch(e){ log("❌ Error updating board: " + e); }
    }
});

// Log helper
function log(msg){ 
    const p = document.createElement("div"); 
    p.textContent = msg; 
    logDiv.appendChild(p);
}
</script>
</body>
</html>
